@model LoginViewModel
@{
    ViewData["Title"] = "Login";
}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@ViewData["Title"] - MyApp</title>

    <style>
        .form-container {
            max-width: 420px;
            margin: 5% auto;
            padding: 2rem;
            background: linear-gradient(145deg, #3b261a, #2e1a10); /* faux depth effect */
            border: 3px double #b78d4c;
            border-radius: 1.2rem;
            box-shadow: 0 0 25px rgba(183, 141, 76, 0.2), 0 0 10px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(1px);
            position: relative;
            overflow: hidden;
        }

            .form-container::before {
                content: "";
                position: absolute;
                inset: 0;
                border-radius: 1.2rem;
                background: radial-gradient( circle at top left, rgba(255, 255, 255, 0.05), transparent 70% );
                z-index: 0;
            }

        /* NAV TABS */
        .nav-tabs .nav-link {
            font-family: 'Bebas Neue', cursive;
            font-size: 1.4rem;
            color: #f3c87a;
            background: transparent;
            border: none;
            text-shadow: 0 0 2px #b78d4c;
            transition: all 0.3s ease-in-out;
            position: relative;
        }

            .nav-tabs .nav-link::after {
                content: '';
                display: block;
                height: 2px;
                background: #f3c87a;
                transform: scaleX(0);
                transform-origin: left;
                transition: transform 0.3s ease;
            }

            .nav-tabs .nav-link:hover::after {
                transform: scaleX(1);
            }

            .nav-tabs .nav-link.active {
                background-color: #b85c38;
                color: #fff;
                border-radius: 0.5rem 0.5rem 0 0;
                text-shadow: none;
            }

        /* LABELS */
        label {
            color: #f8e4c2;
            font-weight: 600;
            font-size: 0.95rem;
        }

        /* INPUT FIELDS */
        input.form-control {
            border-radius: 0.5rem;
            background-color: #fffdf8;
            border: 1px solid #b78d4c;
            color: #3b261a;
            font-size: 0.95rem;
            padding: 0.6rem;
        }

            input.form-control:focus {
                border-color: #d3a857;
                box-shadow: 0 0 0 0.25rem rgba(211, 168, 87, 0.25);
                outline: none;
            }

        /* BUTTONS (only hover defined here; use shared styles elsewhere) */
        .btn-primary:hover,
        .btn-success:hover {
            background-color: #6f3d2b;
            border-color: #6f3d2b;
            box-shadow: 0 0 12px rgba(183, 141, 76, 0.5);
        }

        /* ERROR TEXT */
        .text-danger {
            color: #ff9980;
        }

        /* CONTENT AREA */
        .tab-content {
            margin-top: 1.5rem;
            z-index: 1;
            position: relative;
        }

    </style>
</head>

<body>
    <div class="form-container">
        <ul class="nav nav-tabs mb-3" id="authTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="signin-tab" data-bs-toggle="tab" data-bs-target="#signin"
                        type="button" role="tab" aria-controls="signin" aria-selected="true">
                    Sign In
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="signup-tab" data-bs-toggle="tab" data-bs-target="#signup" type="button"
                        role="tab" aria-controls="signup" aria-selected="false">
                    Sign Up
                </button>
            </li>
        </ul>

        <div class="tab-content" id="authTabsContent">
            <!-- Sign In -->
            <div class="tab-pane fade show active" id="signin" role="tabpanel" aria-labelledby="signin-tab">
                <form asp-action="Login" asp-controller="Account" method="post" novalidate>
                    <div class="mb-3">
                        <label asp-for="Email" class="form-label"></label>
                        <input asp-for="Email" class="form-control" />
                        <span asp-validation-for="Email" class="text-danger"></span>
                    </div>
                    <div class="mb-3">
                        <label asp-for="Password" class="form-label"></label>
                        <input asp-for="Password" type="password" class="form-control" />
                        <span asp-validation-for="Password" class="text-danger"></span>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">Sign In</button>
                </form>
            </div>

            <!-- Sign Up -->
            <div class="tab-pane fade" id="signup" role="tabpanel" aria-labelledby="signup-tab">
                <form asp-action="Register" asp-controller="Account" method="post" novalidate>
                    <div class="mb-3">
                        <label for="UserName" class="form-label">UserName</label>
                        <input type="text" id="UserName" name="UserName" class="form-control" required />
                        <small id="usernameFeedback" style="color:#ff9980; display:none;"></small>
                    </div>

                    <div class="mb-3">
                        <label for="EmailSignUp" class="form-label">Email</label>
                        <input type="email" id="EmailSignUp" name="Email" class="form-control" required />
                        <small id="emailFeedback" style="color:#ff9980; display:none;"></small>
                    </div>

                    <div class="mb-3">
                        <label for="PasswordSignUp" class="form-label">Password</label>
                        <input type="password" id="PasswordSignUp" name="Password" class="form-control" required />
                    </div>
                    <div class="mb-3">
                        <label for="Phone" class="form-label">Phone Number</label>
                        <input type="tel" id="Phone" name="Phone" class="form-control" pattern="\d{10}" placeholder="10-digit number" required />
                    </div>
                    <button type="submit" class="btn btn-success w-100">Sign Up</button>
                </form>
            </div>
        </div>
    </div>
    <script>
        // Helper function to call your API endpoints
        async function checkExists(url, paramName, value) {
          if (!value.trim()) return false;

          try {
            const response = await fetch(`${url}?${paramName}=${encodeURIComponent(value)}`);
            if (!response.ok) return false;
            const data = await response.json();
            return data.exists;
          } catch {
            return false;
          }
        }

        // Get inputs and feedback elements
        const usernameInput = document.getElementById('UserName');
        const usernameFeedback = document.getElementById('usernameFeedback');

        const emailInput = document.getElementById('EmailSignUp');
        const emailFeedback = document.getElementById('emailFeedback');

        // Debounce helper so we don't spam API on every keystroke
        function debounce(fn, delay) {
          let timer;
          return function (...args) {
            clearTimeout(timer);
            timer = setTimeout(() => fn.apply(this, args), delay);
          };
        }

        // Check username uniqueness live
        usernameInput.addEventListener('input', debounce(async () => {
          const exists = await checkExists('/Account/CheckUsername', 'username', usernameInput.value);
          if (exists) {
            usernameFeedback.style.display = 'inline';
            usernameFeedback.textContent = 'Username already taken';
          } else {
            usernameFeedback.style.display = 'none';
            usernameFeedback.textContent = '';
          }
        }, 400));

        // Check email uniqueness live
        emailInput.addEventListener('input', debounce(async () => {
          const exists = await checkExists('/Account/CheckEmail', 'email', emailInput.value);
          if (exists) {
            emailFeedback.style.display = 'inline';
            emailFeedback.textContent = 'Email already in use';
          } else {
            emailFeedback.style.display = 'none';
            emailFeedback.textContent = '';
          }
        }, 400));
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <partial name="_ValidationScriptsPartial" />
</body>

</html>
