@model List<EIUBetApp.Models.Player>

@{
    ViewData["Title"] = "Player Manager";
}


<!DOCTYPE html>
<html>
<head>
    <title>3D Dice Game</title>
    <link rel="stylesheet" />
    <style>
        .container {
            color: white;
        }

        .table th {
            color: black !important;
        }

        .table thead,
        .table tbody td {
            color: white;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h3>👤 Player Management</h3>

        <table class="table table-hover table-bordered mt-3">
            <thead class="table-light">
                <tr>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Balance</th>
                    <th>Online</th>
                    <th>Available</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var player in Model)
                {
                    <tr data-player="@player.PlayerId">
                        <td>@player.User?.Username</td>
                        <td>@player.User?.Email</td>
                        <td class="bal-cell" data-row="@player.PlayerId">
                            $@player.Balance.ToString("F2")
                        </td>


                        <td>@(player.OnlineStatus == true ? "🟢" : "🔴")</td>
                        <td>@(player.IsAvailable == true ? "Yes" : "No")</td>
                        <td>
                            <div class="input-group input-group-sm">
                                <input type="number" min="1" step="1"
                                       class="form-control" placeholder="Amount"
                                       id="amt-@player.PlayerId" />
                                <button type="button"
                                        class="btn btn-success addBalBtn"
                                        data-player="@player.PlayerId">
                                    💸 Add
                                </button>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>
    <script>
        const hub = new signalR.HubConnectionBuilder()
                .withUrl("/betHub")
                .build();

        hub.start().catch(console.error);

        // 1) send add-balance
        document.querySelectorAll(".addBalBtn").forEach(btn=>{
            btn.addEventListener("click",async ()=>{
                const id   = btn.dataset.player;
                const amt  = document.getElementById(`amt-${id}`).value;
                console.log(amt);
                if(!amt) return alert("Enter amount");

                        const res = await fetch("/Admin/AddBalance", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: new URLSearchParams({
                playerId: id,
                amount: amt       // amt is the raw string from input
            })
        });
                if(!res.ok){ alert("Error"); return; }
                document.getElementById(`amt-${id}`).value="";
            });
        });

        // 2) live update for every admin page
        hub.on("UpdatePlayerBalance", data=>{
            const row = document.querySelector(`[data-row='${data.playerId}']`);
            if(row){
                row.querySelector(".bal-cell").textContent = "$"+data.newBalance.toFixed(2);
            }
        });
    </script>


</body>
</html>

